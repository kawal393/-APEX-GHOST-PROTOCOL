<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>APEX Ghost Protocol — The Witness Network</title>
  <meta name="description" content="When truth becomes scarce, witnesses become infrastructure."/>

  <style>
    :root{
      --bg0:#05070B; --bg1:#070A12;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.035);
      --stroke: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --muted2: rgba(255,255,255,.45);
      --gold:#D6B35A; --gold2:#B99233;
      --blue:#6AA8FF;
      --ok:#34D399; --warn:#FBBF24; --bad:#FB7185;
      --shadow: 0 22px 80px rgba(0,0,0,.55);
      --radius: 22px; --radius2: 16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 10% -10%, rgba(106,168,255,.16), transparent 60%),
        radial-gradient(1000px 700px at 95% 5%, rgba(214,179,90,.14), transparent 60%),
        radial-gradient(1000px 800px at 50% 120%, rgba(106,168,255,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* Keep all UI above effects */
    .wrap{max-width:1120px;margin:0 auto;padding:26px 16px 70px; position:relative; z-index:30;}

    /* === LOGO VEIL (FIXED) ===
       IMPORTANT: Put apex-sigil.png in the SAME folder as index.html
       If you placed it in /assets/, change url("apex-sigil.png") to url("assets/apex-sigil.png")
    */
    body:before{
      content:"";
      position:fixed;
      inset:-20%;
      background:
        radial-gradient(circle at 30% 20%, rgba(214,179,90,.12), transparent 45%),
        radial-gradient(circle at 70% 30%, rgba(106,168,255,.10), transparent 45%),
        url("apex-sigil.png");
      background-repeat:no-repeat;
      background-size: 1100px auto;
      background-position: 50% 22%;
      opacity:.34;                 /* <-- stronger so you SEE it */
      pointer-events:none;
      z-index:5;                   /* <-- ABOVE particles */
      transform: translateZ(0);
      filter: saturate(1.08) contrast(1.05);
    }

    /* Mist film (slightly reduced so logo shows) */
    body:after{
      content:"";
      position:fixed;
      inset:0;
      background:
        radial-gradient(900px 420px at 50% 15%, rgba(214,179,90,.06), transparent 62%),
        radial-gradient(900px 520px at 55% 65%, rgba(106,168,255,.05), transparent 62%),
        linear-gradient(180deg, rgba(0,0,0,.14), rgba(0,0,0,.34));
      opacity:.45;
      pointer-events:none;
      z-index:6;                   /* <-- ABOVE logo slightly, but not hiding it */
    }

    /* MOVING PARTICLES CANVAS */
    #apexParticles{
      position:fixed;
      inset:0;
      z-index:4;                   /* <-- BELOW logo */
      pointer-events:none;
      opacity:.40;
      mix-blend-mode:screen;
    }

    .topbar{display:flex;align-items:center;justify-content:space-between;gap:14px;margin-bottom:14px}
    .brand{display:flex;align-items:center;gap:12px;min-width:0}
    .sig{
      width:42px;height:42px;border-radius:14px;border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(circle at 35% 30%, rgba(214,179,90,.35), transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(106,168,255,.35), transparent 55%),
        linear-gradient(135deg, rgba(214,179,90,.18), rgba(106,168,255,.12));
      box-shadow: 0 12px 34px rgba(0,0,0,.35);
      position:relative; overflow:hidden;
    }
    .sig:after{
      content:""; position:absolute; inset:-40%;
      background: conic-gradient(from 180deg, rgba(214,179,90,.0), rgba(214,179,90,.38), rgba(106,168,255,.32), rgba(214,179,90,.0));
      animation: spin 12s linear infinite; opacity:.85;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .brand h1{margin:0;font-size:13px;letter-spacing:.18em;text-transform:uppercase;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .brand .sub{margin-top:3px;font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .pillrow{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end}
    .pill{
      display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 26px rgba(0,0,0,.30);
      font-size:12px; user-select:none;
      text-decoration:none;
    }
    .mono{font-family:var(--mono)}
    .gold{color:rgba(214,179,90,.95);font-weight:900}

    .panel{
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(900px 340px at 15% 15%, rgba(214,179,90,.16), transparent 60%),
        radial-gradient(900px 360px at 88% 20%, rgba(106,168,255,.14), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      transform: translateZ(0);
    }
    .panel:before{
      content:""; position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(214,179,90,.0), rgba(214,179,90,.10), rgba(106,168,255,.10), rgba(214,179,90,.0));
      opacity:.45; transform: translateX(-45%);
      animation: sweep 8s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes sweep{0%,100%{transform:translateX(-45%)}50%{transform:translateX(45%)}}

    .hero{padding:22px 18px 16px}
    .heroTop{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .hero h2{margin:0;font-size:30px;letter-spacing:.06em;text-transform:uppercase;line-height:1.05}
    .hero h2 span{
      background: linear-gradient(90deg, var(--gold), rgba(255,255,255,.96), var(--blue));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .hero p{margin:10px 0 0;color:rgba(255,255,255,.82);font-size:13px;line-height:1.45;max-width:820px}

    .grid{display:grid;gap:12px;margin-top:14px}
    @media(min-width: 980px){ .grid{grid-template-columns: 1.25fr .75fr;} }

    .card{
      border-radius: var(--radius2);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
      box-shadow: 0 16px 34px rgba(0,0,0,.25);
      padding:14px;
      position:relative;
      overflow:hidden;
      transform: translateZ(0);
    }
    .card:before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(600px 200px at 18% 0%, rgba(214,179,90,.10), transparent 60%),
        radial-gradient(600px 220px at 82% 0%, rgba(106,168,255,.10), transparent 60%);
      opacity:.55;
      pointer-events:none;
    }

    .tagrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px; position:relative; z-index:1;}
    .tag{
      padding:10px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      font-size:12px;color:var(--muted);
      position:relative; z-index:1;
    }

    .btn{
      border:none;cursor:pointer;border-radius:14px;padding:11px 14px;
      font-weight:900;font-size:13px;letter-spacing:.02em;
      color: rgba(10,12,16,.95);
      background: linear-gradient(135deg, var(--gold), var(--gold2));
      box-shadow: 0 16px 34px rgba(214,179,90,.18);
      transition: transform .10s ease, filter .10s ease;
      position:relative; z-index:1;
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.03)}
    .btn:active{transform: translateY(0px); filter: brightness(.98)}
    .btn2{
      cursor:pointer;border-radius:14px;padding:11px 14px;
      font-weight:900;font-size:13px;color:rgba(255,255,255,.90);
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      transition: transform .10s ease, border-color .10s ease;
      position:relative; z-index:1;
    }
    .btn2:hover{transform: translateY(-1px); border-color: rgba(214,179,90,.35)}
    .btn2:active{transform: translateY(0px)}

    label{display:block;font-size:11px;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.58)}
    input{
      width:100%;
      margin-top:10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.92);
      padding:12px 12px;
      outline:none;
      font-size:13px;
      position:relative; z-index:1;
    }
    input::placeholder{color: rgba(255,255,255,.40)}

    .kv{display:grid;gap:10px; position:relative; z-index:1;}
    .k{
      border-radius:14px;border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      padding:12px;
      position:relative; z-index:1;
    }
    .k .t{font-size:11px;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.58)}
    .k .v{margin-top:8px;font-weight:900}
    .v.dim{color:rgba(255,255,255,.75)}
    .v.ok{color:var(--ok)}
    .v.warn{color:var(--warn)}
    .v.bad{color:var(--bad)}

    .footer{margin-top:14px;color:var(--muted);font-size:12px;line-height:1.5;padding:0 4px; position:relative; z-index:1;}
    .footer a{color:rgba(214,179,90,.95);text-decoration:none;border-bottom:1px dashed rgba(214,179,90,.35)}

    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      font-size:12px;
      color:rgba(255,255,255,.82);
    }
    .pulse{
      width:8px;height:8px;border-radius:50%;
      background: var(--ok);
      box-shadow: 0 0 0 4px rgba(52,211,153,.12);
      animation: pulse 1.8s ease-in-out infinite;
    }
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.35)}}

    /* Witness log */
    .log{
      margin-top:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      overflow:hidden;
      position:relative; z-index:1;
    }
    .logHead{
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      background: rgba(0,0,0,.16);
    }
    .logHead .t{
      font-size:11px;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.58)
    }
    .logBody{max-height:240px; overflow:auto;}
    table{width:100%; border-collapse:collapse; font-size:12.5px;}
    thead th{
      text-align:left;
      font-size:11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:rgba(255,255,255,.52);
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      position:sticky; top:0;
    }
    tbody td{
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      color:rgba(255,255,255,.86);
      vertical-align:top;
      font-family: var(--mono);
      word-break:break-word;
    }
    tbody tr:hover{background: rgba(106,168,255,.06);}
  </style>
</head>

<body>
  <canvas id="apexParticles" aria-hidden="true"></canvas>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="sig" aria-hidden="true"></div>
        <div style="min-width:0">
          <h1>APEX Ghost Protocol</h1>
          <div class="sub">Witness Infrastructure • Record Authority</div>
        </div>
      </div>
      <div class="pillrow">
        <div class="pill"><span class="pulse"></span><span class="mono" id="live">LIVE • registry</span></div>
        <a class="pill" href="https://kawal393.github.io/" style="text-decoration:none">
          <span class="muted">APEX</span>&nbsp;<span class="gold">PORTAL</span>
        </a>
      </div>
    </div>

    <section class="panel hero">
      <div class="heroTop">
        <h2><span>Ghost</span> Protocol</h2>
        <div class="pill" style="background:rgba(0,0,0,.18)">
          <span class="mono">FOUNDERS PASS</span>
        </div>
      </div>
      <p>
        When truth becomes scarce, witnesses become infrastructure.
        This system does not persuade. It records. Silence becomes leverage.
      </p>

      <div class="tagrow">
        <div class="tag">No noise</div>
        <div class="tag">Timestamped record</div>
        <div class="tag">Consensus snapshot</div>
        <div class="tag">Presence proof</div>
      </div>
    </section>

    <div class="grid">
      <section class="card">
        <label>Enter — Registry</label>

        <div style="display:grid;gap:10px;margin-top:10px; position:relative; z-index:1;">
          <div>
            <label for="email">Email (required)</label>
            <input id="email" placeholder="you@domain.com" autocomplete="email"/>
          </div>
          <div>
            <label for="name">Name (optional)</label>
            <input id="name" placeholder="Witness ID" autocomplete="name"/>
          </div>
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-top:12px; position:relative; z-index:1;">
          <button class="btn" id="enter">ENTER PROTOCOL</button>
          <button class="btn2" id="seal">SEAL (DEMO)</button>
          <div class="tag" id="hint">Validation required. Registration creates a durable entry.</div>
        </div>

        <div class="log">
          <div class="logHead">
            <div class="t">Witness Log (local)</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end">
              <button class="btn2" id="export">Export CSV</button>
              <button class="btn2" id="wipe">Wipe Local</button>
            </div>
          </div>
          <div class="logBody">
            <table>
              <thead>
                <tr>
                  <th style="width:140px">Timestamp</th>
                  <th style="width:220px">Email (hashed)</th>
                  <th>Name</th>
                </tr>
              </thead>
              <tbody id="logRows"></tbody>
            </table>
          </div>
        </div>

        <div class="footer" style="padding:0;margin-top:12px">
          Local-only demo registry. Later, this becomes an authority ledger.
        </div>
      </section>

      <section class="card">
        <label>Ledger Snapshot</label>
        <div class="kv" style="margin-top:10px">
          <div class="k">
            <div class="t">Witnesses (local)</div>
            <div class="v ok" id="wCount">0</div>
          </div>
          <div class="k">
            <div class="t">Confirmations (local)</div>
            <div class="v dim" id="cCount">0</div>
          </div>
          <div class="k">
            <div class="t">Last Seal</div>
            <div class="v dim mono" id="lastSeal">—</div>
          </div>
        </div>

        <div class="footer" style="padding:0;margin-top:12px">
          Surface Nodes:
          <a href="https://kawal393.github.io/apex-corporate-translator/">APEX Corporate Translator</a> •
          <a href="https://kawal393.github.io/ndis-signal-board/">APEX NDIS Watchtower</a>
        </div>
      </section>
    </div>

    <section class="card" style="margin-top:12px">
      <label>Protocol Rule</label>
      <div style="margin-top:10px;font-size:18px;font-weight:900;letter-spacing:.02em; position:relative; z-index:1;">
        Silence = Gravity
      </div>
      <div class="footer" style="padding:0;margin-top:8px">
        The record becomes leverage when everything else becomes fake.
      </div>
    </section>

    <div class="footer" style="margin-top:14px">
      © 2026 APEX • <span class="gold">Own the record.</span>
    </div>
  </div>

<script>
(() => {
  const KEY = "apex_ghost_protocol";
  const $ = (id) => document.getElementById(id);

  function stamp(){
    const d = new Date();
    const y=d.getFullYear();
    const m=String(d.getMonth()+1).padStart(2,"0");
    const day=String(d.getDate()).padStart(2,"0");
    const hh=String(d.getHours()).padStart(2,"0");
    const mm=String(d.getMinutes()).padStart(2,"0");
    return `${y}-${m}-${day} ${hh}:${mm}`;
  }

  function load(){
    return JSON.parse(localStorage.getItem(KEY) || `{"witnesses":[],"confirmations":0,"lastSeal":""}`);
  }
  function save(data){
    localStorage.setItem(KEY, JSON.stringify(data));
  }

  function hashEmail(email){
    let h = 2166136261;
    for(let i=0;i<email.length;i++){
      h ^= email.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return ("00000000" + (h >>> 0).toString(16)).slice(-8);
  }

  function renderLog(){
    const d = load();
    const tb = $("logRows");
    if(!d.witnesses.length){
      tb.innerHTML = `<tr><td colspan="3" style="padding:12px; color:rgba(255,255,255,.55)">No witnesses yet.</td></tr>`;
      return;
    }
    tb.innerHTML = d.witnesses.slice(0,50).map(w => {
      const em = (w.email || "").trim().toLowerCase();
      return `
        <tr>
          <td>${(w.ts || "—")}</td>
          <td>${em ? ("#" + hashEmail(em)) : "—"}</td>
          <td>${(w.name || "—")}</td>
        </tr>
      `;
    }).join("");
  }

  function render(){
    const d = load();
    $("wCount").textContent = d.witnesses.length;
    $("cCount").textContent = d.confirmations;
    $("lastSeal").textContent = d.lastSeal ? d.lastSeal : "—";
    renderLog();
  }

  $("enter").addEventListener("click", () => {
    const email = ($("email").value || "").trim().toLowerCase();
    const name = ($("name").value || "").trim();
    if(!email || !email.includes("@")){
      $("hint").textContent = "Email required. Enter a real address.";
      return;
    }
    const d = load();
    const exists = d.witnesses.some(w => (w.email || "").toLowerCase() === email);
    if(!exists){
      d.witnesses.unshift({email, name, ts: stamp()});
      d.confirmations += 1;
      d.lastSeal = stamp();
      save(d);
      $("hint").textContent = "Registration sealed. You are now a witness.";
    }else{
      d.confirmations += 1;
      d.lastSeal = stamp();
      save(d);
      $("hint").textContent = "Witness already registered. Confirmation recorded.";
    }
    render();
  });

  $("seal").addEventListener("click", () => {
    const d = load();
    d.confirmations += 1;
    d.lastSeal = stamp();
    save(d);
    $("hint").textContent = "Seal recorded (demo).";
    render();
  });

  $("export").addEventListener("click", () => {
    const d = load();
    const rows = [["timestamp","email","name"], ...d.witnesses.map(w => [w.ts||"", w.email||"", w.name||""])];
    const csv = rows.map(r => r.map(v => {
      const s = String(v).replaceAll('"','""');
      return `"${s}"`;
    }).join(",")).join("\n");

    const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "APEX_GhostProtocol_WitnessLog.csv";
    a.click();
    URL.revokeObjectURL(a.href);
  });

  $("wipe").addEventListener("click", () => {
    if(!confirm("Wipe local Ghost Protocol data on this device?")) return;
    localStorage.removeItem(KEY);
    $("hint").textContent = "Local registry wiped.";
    render();
  });

  render();
})();
</script>

<script>
/* APEX PARTICLES */
(() => {
  const canvas = document.getElementById("apexParticles");
  if(!canvas) return;

  const ctx = canvas.getContext("2d", { alpha: true });
  let W=0,H=0,DPR=1;
  let particles=[];
  let raf=0;

  const css = getComputedStyle(document.documentElement);
  const GOLD = (css.getPropertyValue("--gold").trim() || "#D6B35A");
  const BLUE = (css.getPropertyValue("--blue").trim() || "#6AA8FF");

  const settings = {
    count: 78,
    speed: 0.22,
    linkDist: 150,
    starSize: 1.35,
    twinkle: 0.33,
  };

  const reduce = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  if(reduce){
    canvas.style.opacity = ".16";
    return;
  }

  function rand(min,max){ return min + Math.random()*(max-min); }

  function resize(){
    DPR = Math.min(2, window.devicePixelRatio || 1);
    W = Math.floor(innerWidth);
    H = Math.floor(innerHeight);
    canvas.width = Math.floor(W * DPR);
    canvas.height = Math.floor(H * DPR);
    canvas.style.width = W + "px";
    canvas.style.height = H + "px";
    ctx.setTransform(DPR,0,0,DPR,0,0);

    const target = Math.max(48, Math.min(130, Math.floor((W*H)/17000)));
    settings.count = target;
    seed();
  }

  function seed(){
    particles = [];
    for(let i=0;i<settings.count;i++){
      particles.push({
        x: rand(0,W), y: rand(0,H),
        vx: rand(-settings.speed, settings.speed),
        vy: rand(-settings.speed, settings.speed),
        r: rand(0.65, settings.starSize),
        a: rand(0.25, 0.95),
        hue: Math.random() < 0.62 ? "gold" : "blue",
        phase: rand(0, Math.PI*2)
      });
    }
  }

  function draw(){
    ctx.clearRect(0,0,W,H);

    const g = ctx.createRadialGradient(W*0.5,H*0.35, 0, W*0.5,H*0.35, Math.max(W,H)*0.9);
    g.addColorStop(0,"rgba(214,179,90,.05)");
    g.addColorStop(0.55,"rgba(106,168,255,.035)");
    g.addColorStop(1,"rgba(0,0,0,0)");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    for(let i=0;i<particles.length;i++){
      const p = particles[i];
      for(let j=i+1;j<particles.length;j++){
        const q = particles[j];
        const dx = p.x-q.x, dy=p.y-q.y;
        const d = Math.hypot(dx,dy);
        if(d < settings.linkDist){
          const t = 1 - (d/settings.linkDist);
          ctx.globalAlpha = t*0.20;
          ctx.lineWidth = 1;
          ctx.strokeStyle = (p.hue==="gold" || q.hue==="gold")
            ? "rgba(214,179,90,.55)"
            : "rgba(106,168,255,.55)";
          ctx.beginPath();
          ctx.moveTo(p.x,p.y);
          ctx.lineTo(q.x,q.y);
          ctx.stroke();
        }
      }
    }

    for(const p of particles){
      p.phase += 0.02;
      const tw = 1 + Math.sin(p.phase)*settings.twinkle;
      const color = p.hue === "gold" ? GOLD : BLUE;

      ctx.globalAlpha = Math.max(0.06, Math.min(1, p.a*0.9));
      ctx.shadowBlur = 18;
      ctx.shadowColor = color;
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r*tw, 0, Math.PI*2);
      ctx.fill();

      ctx.shadowBlur = 0;
      ctx.globalAlpha = Math.max(0.10, Math.min(1, p.a));
      ctx.fillStyle = "rgba(255,255,255,.85)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, Math.max(0.6, p.r*0.52), 0, Math.PI*2);
      ctx.fill();

      p.x += p.vx;
      p.y += p.vy;
      if(p.x < -20) p.x = W+20;
      if(p.x > W+20) p.x = -20;
      if(p.y < -20) p.y = H+20;
      if(p.y > H+20) p.y = -20;
    }

    ctx.globalAlpha = 1;
    raf = requestAnimationFrame(draw);
  }

  window.addEventListener("resize", resize, {passive:true});
  resize();
  cancelAnimationFrame(raf);
  raf = requestAnimationFrame(draw);
})();
</script>

</body>
</html>
